---
import "@styles/index.css";
import Header from "@components/Header.astro";
import Footer from "@components/Footer.astro";
import Metadata from "@components/Metadata.astro";
import { fetchNavigation } from "@utils/data/nav.js";

const currentUrl = Astro.url.pathname;
const nav = await fetchNavigation();

const {
  globals,
  schema = "page",
  pageTitle,
  description,
  ogImage,
  fullUrl,
  ...otherProps
} = Astro.props;

const isProduction = import.meta.env.MODE === "production";
---

<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="color-scheme" content="light dark" />
    <title>{pageTitle || globals.site_name}</title>
    <link
      rel="preload"
      href="/fonts/ml.woff2"
      as="font"
      type="font/woff2"
      crossorigin="anonymous"
    />
    <link
      rel="preload"
      href="/fonts/mlb.woff2"
      as="font"
      type="font/woff2"
      crossorigin="anonymous"
    />

    <Metadata
      schema={schema}
      globals={globals}
      pageTitle={pageTitle}
      description={description}
      ogImage={ogImage}
      fullUrl={fullUrl}
      {...otherProps}
    />

    <script defer src="/scripts/index.js"></script>
    {
      isProduction && (
        <>
          <script defer data-domain="coryd.dev" src="/js/script.js" />
          <script>
            window.plausible = window.plausible || function(){" "}
            {(window.plausible.q = window.plausible.q || []).push(arguments)}
          </script>
        </>
      )
    }
    <noscript>
      <style>.client-side {display:none}</style>
    </noscript>
  </head>
  <body>
    <div class="main-wrapper">
      <main>
        <Header nav={nav} siteName={globals?.site_name} url={currentUrl} />
        <div class="default-wrapper">
          <slot />
        </div>
      </main>
      <Footer nav={nav} />
    </div>
  </body>
</html>
